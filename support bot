from telegram import Update , ReplyKeyboardMarkup , ReplyKeyboardRemove , InlineKeyboardButton , InlineKeyboardMarkup
from telegram.ext import ContextTypes , ApplicationBuilder , CommandHandler , MessageHandler , filters , ConversationHandler , CallbackQueryHandler

se = 0
re = 0
B = []
async def start (update:Update , context:ContextTypes.DEFAULT_TYPE):
    global key_2
    key = [['ğŸ“Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§']]
    key_2 = ReplyKeyboardMarkup(key , resize_keyboard=True)
    if update.message.chat.id !=... :
        await context.bot.send_message(text=f'Ø³Ù„Ø§Ù… {update.message.from_user.first_name}ğŸ‘‹ğŸ»â¤ï¸\n Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø§ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ' , chat_id=update.message.chat.id)
        await context.bot.send_message(text='Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ :' , chat_id=update.message.chat.id , reply_markup=key_2)
    else : 
        await context.bot.send_message(text=f'Ø³Ù„Ø§Ù… {update.message.from_user.first_name}ğŸ‘‹ğŸ»â¤ï¸\n Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø§ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ' , chat_id=update.message.chat.id )
        await context.bot.send_message(text='Ø´Ù…Ø§ Ø§Ø¯Ù…ÛŒÙ† Ù‡Ø³ØªÛŒØ¯.âœ…' , chat_id=update.message.chat.id)


async def text (update:Update , context:ContextTypes.DEFAULT_TYPE):
    if update.message.text == 'ğŸ“Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§' :
        await context.bot.send_message(text='ğŸ’¬ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:' , chat_id= update.message.chat.id , reply_markup=ReplyKeyboardRemove())
        
    return se

async def send_message (update:Update , context:ContextTypes.DEFAULT_TYPE):
    global key_2 , user

    button = [[InlineKeyboardButton(text='Ù¾Ø§Ø³Ø® ğŸ“¤' , callback_data='Reply') , InlineKeyboardButton(text='Ø¨Ù„Ø§Ú© âŒ' , callback_data='Block')] , [InlineKeyboardButton(text='Ø¢Ù†Ø¨Ù„Ø§Ú© ğŸ”„', callback_data='Unblock')]]
    button_2 = InlineKeyboardMarkup(button)

    if str(update.message.chat.id) not in B :
        await context.bot.copy_message(chat_id=... , from_chat_id=update.message.chat.id , message_id=update.message.message_id)
        await context.bot.send_message(chat_id=... , text=f'ğŸ’¬\nUserName : @{update.message.from_user.username}\nChatID : {update.message.chat.id}' , reply_markup=button_2)
        await context.bot.send_message(text='Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.âœ…' , chat_id=update.message.chat.id , reply_markup=key_2)
    else :
        await context.bot.send_message(text='âŒØ´Ù…Ø§ Ø¨Ù„Ø§Ú© Ø´Ø¯Ù‡ Ø§ÛŒØ¯.âŒ' , chat_id=update.message.chat.id)

    return ConversationHandler.END


async def reply (update:Update , context:ContextTypes.DEFAULT_TYPE):
    global re , user

    if re != 0 :
        await context.bot.send_message(text='ğŸ“© Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† : ' , chat_id=user) 
        await context.bot.copy_message(chat_id= user , from_chat_id=update.message.chat.id , message_id=update.message.message_id)  
        await context.bot.send_message(text='Ù¾Ø§Ø³Ø® Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.âœ…' , chat_id=update.message.chat.id) 
        re = 0 


async def Button_click (update:Update , context:ContextTypes.DEFAULT_TYPE):
    global re , user
    query = update.callback_query

    if query.data == 'Reply' :
        re = 1
        query_text = query.message.text
        user = query_text.split('ChatID : ' , 1)[1]
        await context.bot.send_message(text=f'Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®ÛŒØ¯ Ø¨Ù‡ : {user}ğŸ†”' , chat_id= query.message.chat.id)
        
    if query.data == 'Block':
        query_text = query.message.text
        user = query_text.split('ChatID : ' , 1)[1]
        B.append(user)
        await context.bot.send_message(text=f'Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ú†Øª Ø§ÛŒØ¯ÛŒ {user}Ø¨Ù„Ø§Ú© Ø´Ø¯ ğŸ…±ï¸' , chat_id= query.message.chat.id)

    if query.data == 'Unblock':
        query_text = query.message.text
        user = query_text.split('ChatID : ' , 1)[1]
        if user in B :
            B.remove(user)
            await context.bot.send_message(text=f'Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ú†Øª Ø§ÛŒØ¯ÛŒ {user} Ø¢Ù†Ø¨Ù„Ø§Ú© Ø´Ø¯ ğŸ”„' , chat_id= query.message.chat.id)
        else :
            await context.bot.send_message(text='Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø¨Ù„Ø§Ú© Ù†Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª.â' , chat_id= query.message.chat.id)

    


if __name__ == '__main__':
    application = ApplicationBuilder().token("6593069890:AAF1ltd1oe-j3CnMd1G4NcgCrOc1hChEYkY").build()

    start_handler = CommandHandler('start' , start)
    application.add_handler(start_handler)

    

    se_handler = ConversationHandler(
        entry_points=[MessageHandler(filters.Regex('^(ğŸ“Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§)$') , text)] ,
        states={
            se : [MessageHandler(filters.ALL , send_message)]
        },
        fallbacks=[]
    )
    application.add_handler(se_handler)

    button_handler = CallbackQueryHandler(Button_click)
    application.add_handler(button_handler)

    re_handler = MessageHandler(filters.ALL , reply)
    application.add_handler(re_handler)

    application.run_polling()
